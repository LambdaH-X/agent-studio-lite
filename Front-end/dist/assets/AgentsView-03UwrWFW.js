import{g as Z,r as w,a as U,h as ee,i as P,o as C,w as r,b as g,d as a,f as p,k as z,p as te,e as i,c as O,m as ae,t as k,n as oe,q as ne,E as m,s as re}from"./index-CXVfb7lr.js";import{L as le}from"./Layout-DWpSQjxp.js";import{u as se}from"./userStore-BTjMa1Y5.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const f=Z.create({timeout:1e4,headers:{"Content-Type":"application/json"}});f.interceptors.request.use(o=>{const t=localStorage.getItem("token");return t&&(o.headers.Authorization=`Bearer ${t}`),o},o=>(console.error("请求错误:",o),Promise.reject(o)));f.interceptors.response.use(o=>o.data,o=>{if(console.error("响应错误:",o),o.response)switch(o.response.status){case 401:console.error("未授权，请重新登录");break;case 403:console.error("拒绝访问");break;case 404:console.error("请求的资源不存在");break;case 500:console.error("服务器错误");break;default:console.error(`请求失败: ${o.response.data.message||"未知错误"}`)}else o.request&&console.error("网络错误，请检查网络连接");return Promise.reject(o)});const V={async getAgents(o={}){try{const t=await f.get("/api/agents",{params:o});return console.log("获取智能体列表成功:",t),t}catch(t){throw console.error("获取智能体列表失败:",t),t}},async getAgentById(o){try{const t=await f.get(`/api/agents/${o}`);return console.log(`获取智能体 ${o} 详情成功:`,t),t}catch(t){throw console.error(`获取智能体 ${o} 详情失败:`,t),t}},async createAgent(o){try{const t=await f.post("/api/agents",o);return console.log("创建智能体成功:",t),t}catch(t){throw console.error("创建智能体失败:",t),t}},async updateAgent(o,t){try{const c=await f.put(`/api/agents/${o}`,t);return console.log(`更新智能体 ${o} 成功:`,c),c}catch(c){throw console.error(`更新智能体 ${o} 失败:`,c),c}},async deleteAgent(o){try{const t=await f.delete(`/api/agents/${o}`);return console.log(`删除智能体 ${o} 成功:`,t),t}catch(t){throw console.error(`删除智能体 ${o} 失败:`,t),t}}},ce={class:"agents-container"},ue={class:"page-header"},de={key:0,class:"loading-container"},pe={class:"agent-name"},ge={class:"name-text"},me={class:"agent-desc"},fe={key:2,class:"pagination-container"},ye={class:"dialog-footer"},_e={__name:"AgentsView",setup(o){const t=se(),c=w([]),x=w(!1),y=w(!1),_=w("create"),$=w(null),h=w(null),u=U({currentPage:1,pageSize:10,total:0}),s=U({name:"",description:"",type:"general",status:"1",config:"{}"}),T={name:[{required:!0,message:"请输入智能体名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],description:[{max:200,message:"描述不能超过 200 个字符",trigger:"blur"}],config:[{validator:(l,e,d)=>{if(e)try{JSON.parse(e),d()}catch{d(new Error("请输入有效的JSON格式"))}else d()},trigger:"blur"}]},b=async()=>{x.value=!0;try{const l={page:u.currentPage,pageSize:u.pageSize},e=await V.getAgents(l);e&&e.data?(c.value=Array.isArray(e.data)?e.data:[],u.total=e.total||0):(c.value=Array.isArray(e)?e:[],u.total=c.value.length),console.log("获取智能体列表成功:",c.value)}catch(l){console.error("获取智能体列表失败:",l),m.error("获取智能体列表失败，请稍后重试"),c.value=[],u.total=0}finally{x.value=!1}},j=()=>{_.value="create",$.value=null,Object.assign(s,{name:"",description:"",type:"general",status:"1",config:"{}"}),h.value&&h.value.resetFields(),y.value=!0},D=async l=>{_.value="edit",$.value=l.id;try{const e=await V.getAgentById(l.id);Object.assign(s,{name:e.name||"",description:e.description||"",type:e.type||"general",status:String(e.status||1),config:typeof e.config=="string"?e.config:JSON.stringify(e.config||{},null,2)}),y.value=!0}catch(e){console.error("获取智能体详情失败:",e),m.error("获取智能体详情失败，请稍后重试")}},E=(l,e)=>{re.confirm(`确定要删除智能体「${e}」吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await V.deleteAgent(l),m.success("删除成功"),await b()}catch(d){console.error("删除智能体失败:",d),m.error("删除失败，请稍后重试")}}).catch(()=>{})},J=async()=>{h.value&&await h.value.validate(async l=>{if(l)try{const e={...s,status:parseInt(s.status),config:s.config?JSON.parse(s.config):{}};_.value==="create"?(await V.createAgent(e),m.success("创建成功")):(await V.updateAgent($.value,e),m.success("更新成功")),y.value=!1,await b()}catch(e){console.error(`${_.value==="create"?"创建":"更新"}智能体失败:`,e),m.error(`${_.value==="create"?"创建":"更新"}失败，请稍后重试`)}})},M=l=>{u.pageSize=l,u.currentPage=1,b()},q=l=>{u.currentPage=l,b()},F=l=>({general:"primary",knowledge:"success",task:"warning",creative:"info"})[l]||"default",L=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return ee(async()=>{console.log("Agent管理页面已加载"),t.initialized||await t.initializeUserInfo(),await b()}),(l,e)=>{const d=i("el-button"),B=i("el-skeleton"),v=i("el-table-column"),N=i("el-tag"),R=i("el-table"),G=i("el-pagination"),H=i("el-card"),I=i("el-input"),A=i("el-form-item"),S=i("el-option"),K=i("el-select"),Q=i("el-switch"),W=i("el-form"),X=i("el-dialog");return C(),P(le,{userInfo:z(t).userInfo},{default:r(()=>[g("div",ce,[g("div",ue,[e[10]||(e[10]=g("h1",null,"我的智能体",-1)),a(d,{type:"primary",onClick:j,icon:z(te)},{default:r(()=>[...e[9]||(e[9]=[p("创建智能体",-1)])]),_:1},8,["icon"])]),a(H,{class:"agents-card"},{default:r(()=>[x.value?(C(),O("div",de,[a(B,{rows:5,animated:""})])):(C(),P(R,{key:1,data:c.value,style:{width:"100%"},"empty-text":"暂无智能体数据"},{default:r(()=>[a(v,{prop:"id",label:"ID",width:"180"}),a(v,{prop:"name",label:"名称","min-width":"150"},{default:r(n=>[g("div",pe,[g("div",ge,k(n.row.name),1),g("div",me,k(n.row.description||"无描述"),1)])]),_:1}),a(v,{prop:"type",label:"类型",width:"100"},{default:r(n=>[a(N,{type:F(n.row.type),effect:"light"},{default:r(()=>[p(k(n.row.type||"默认"),1)]),_:2},1032,["type"])]),_:1}),a(v,{prop:"createdAt",label:"创建时间",width:"180"},{default:r(n=>[p(k(L(n.row.createdAt)),1)]),_:1}),a(v,{prop:"status",label:"状态",width:"100"},{default:r(n=>[a(N,{type:n.row.status===1?"success":"danger",effect:"light"},{default:r(()=>[p(k(n.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(v,{label:"操作",width:"180",fixed:"right"},{default:r(n=>[a(d,{type:"primary",size:"small",onClick:Y=>D(n.row),icon:z(oe)},{default:r(()=>[...e[11]||(e[11]=[p(" 编辑 ",-1)])]),_:1},8,["onClick","icon"]),a(d,{type:"danger",size:"small",onClick:Y=>E(n.row.id,n.row.name),icon:z(ne)},{default:r(()=>[...e[12]||(e[12]=[p(" 删除 ",-1)])]),_:1},8,["onClick","icon"])]),_:1})]),_:1},8,["data"])),!x.value&&c.value.length>0?(C(),O("div",fe,[a(G,{"current-page":u.currentPage,"onUpdate:currentPage":e[0]||(e[0]=n=>u.currentPage=n),"page-size":u.pageSize,"onUpdate:pageSize":e[1]||(e[1]=n=>u.pageSize=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:u.total,onSizeChange:M,onCurrentChange:q},null,8,["current-page","page-size","total"])])):ae("",!0)]),_:1}),a(X,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=n=>y.value=n),title:_.value==="create"?"创建智能体":"编辑智能体",width:"500px"},{footer:r(()=>[g("span",ye,[a(d,{onClick:e[7]||(e[7]=n=>y.value=!1)},{default:r(()=>[...e[13]||(e[13]=[p("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:J},{default:r(()=>[...e[14]||(e[14]=[p("确定",-1)])]),_:1})])]),default:r(()=>[a(W,{ref_key:"agentFormRef",ref:h,model:s,rules:T,"label-width":"100px"},{default:r(()=>[a(A,{label:"名称",prop:"name"},{default:r(()=>[a(I,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=n=>s.name=n),placeholder:"请输入智能体名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),a(A,{label:"描述",prop:"description"},{default:r(()=>[a(I,{modelValue:s.description,"onUpdate:modelValue":e[3]||(e[3]=n=>s.description=n),type:"textarea",placeholder:"请输入智能体描述",rows:"3",maxlength:"200"},null,8,["modelValue"])]),_:1}),a(A,{label:"类型",prop:"type"},{default:r(()=>[a(K,{modelValue:s.type,"onUpdate:modelValue":e[4]||(e[4]=n=>s.type=n),placeholder:"请选择智能体类型"},{default:r(()=>[a(S,{label:"通用助手",value:"general"}),a(S,{label:"知识库助手",value:"knowledge"}),a(S,{label:"任务助手",value:"task"}),a(S,{label:"创意助手",value:"creative"})]),_:1},8,["modelValue"])]),_:1}),a(A,{label:"状态",prop:"status"},{default:r(()=>[a(Q,{modelValue:s.status,"onUpdate:modelValue":e[5]||(e[5]=n=>s.status=n),"active-value":"1","inactive-value":"0","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),a(A,{label:"配置信息",prop:"config"},{default:r(()=>[a(I,{modelValue:s.config,"onUpdate:modelValue":e[6]||(e[6]=n=>s.config=n),type:"textarea",placeholder:"请输入JSON格式的配置信息",rows:"4",maxlength:"1000"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])]),_:1},8,["userInfo"])}}},Ae=ie(_e,[["__scopeId","data-v-40d52804"]]);export{Ae as default};
