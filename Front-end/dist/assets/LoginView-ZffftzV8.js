import{r as U,a as C,c as F,o as N,b as a,d as n,w as i,e as p,f as z,g as T,E as u,u as A}from"./index-CXVfb7lr.js";import{u as M}from"./userStore-BTjMa1Y5.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"login-container"},D={class:"login-content"},G={__name:"LoginView",setup(H){const E=A(),r=M(),w=U(null),k=U(!1),l=C({username:"user",password:"123"}),L={username:[{required:!0,message:"è¯·è¾“å…¥ç”¨æˆ·å",trigger:"blur"},{min:3,max:20,message:"é•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:3,max:20,message:"é•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦",trigger:"blur"}]},q=async()=>{var h,o,m,c,g,f,_,d,b,x,I,V,R;if(w.value)try{await w.value.validate(),k.value=!0;const s=await T.post("/api/user/login",{username:l.username,password:l.password}),e=(s==null?void 0:s.data)||{};console.log("å“åº”æ•°æ®ç»“æž„:",e);const y=e.role||((h=e.data)==null?void 0:h.role)||"user",v=e.username||((o=e.data)==null?void 0:o.username)||l.username;if(localStorage.setItem("username",v),localStorage.setItem("userRole",y),e.token||e.code===200&&((m=e.data)!=null&&m.token||(g=(c=e.data)==null?void 0:c.data)!=null&&g.token)){const S=e.token||((f=e.data)==null?void 0:f.token)||((d=(_=e.data)==null?void 0:_.data)==null?void 0:d.token);localStorage.setItem("token",S),console.log("Tokenå·²å­˜å‚¨:",S),r.initialized=!1;const t=e.role||((b=e.data)==null?void 0:b.role)||((I=(x=e.data)==null?void 0:x.data)==null?void 0:I.role)||"user";console.log("ä»Žç™»å½•å“åº”æå–çš„è§’è‰²:",t);try{await r.initializeUserInfo(),console.log("ç™»å½•åŽèŽ·å–çš„ç”¨æˆ·ä¿¡æ¯:",r.userInfo),t&&r.userInfo&&(r.userInfo.role=t,r.role=t,localStorage.setItem("userRole",t))}catch(B){console.error("ç™»å½•åŽèŽ·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",B),r.updateUserInfo({username:v,nickname:v||"ç”¨æˆ·",role:t}),r.role=t,localStorage.setItem("userRole",t)}u.success(e.message||"ç™»å½•æˆåŠŸï¼"),console.log("ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯:",{username:v,role:y}),E.push("/home")}else u.error((e==null?void 0:e.message)||"ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ")}catch(s){if(console.error("ç™»å½•é”™è¯¯è¯¦æƒ…:",{message:s.message,status:(V=s.response)==null?void 0:V.status,data:(R=s.response)==null?void 0:R.data,config:s.config}),s.name==="Error")return;if(s.response){const e=s.response.status;e===500?u.error("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•"):e===401||e===403?u.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"):u.error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${e}`)}else s.request?u.error("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿žæŽ¥"):u.error("è¯·æ±‚é”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•")}finally{k.value=!1}};return(h,o)=>{const m=p("el-input"),c=p("el-form-item"),g=p("el-button"),f=p("el-form"),_=p("el-card");return N(),F("div",j,[o[4]||(o[4]=a("div",{class:"login-background"},[a("div",{class:"login-shape login-shape-1"}),a("div",{class:"login-shape login-shape-2"}),a("div",{class:"login-shape login-shape-3"})],-1)),a("div",D,[n(_,{class:"login-card",shadow:"hover"},{header:i(()=>[...o[2]||(o[2]=[a("div",{class:"login-header"},[a("div",{class:"logo-container"},[a("div",{class:"logo-icon"},"ðŸ¤–")]),a("h2",null,"Agent Studio Lite"),a("p",null,"ç™»å½•æ‚¨çš„è´¦æˆ·")],-1)])]),default:i(()=>[n(f,{ref_key:"loginFormRef",ref:w,model:l,rules:L,"label-width":"80px",class:"login-form"},{default:i(()=>[n(c,{label:"ç”¨æˆ·å",prop:"username"},{default:i(()=>[n(m,{modelValue:l.username,"onUpdate:modelValue":o[0]||(o[0]=d=>l.username=d),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å","prefix-icon":"User",autocomplete:"off",class:"custom-input"},null,8,["modelValue"])]),_:1}),n(c,{label:"å¯†ç ",prop:"password"},{default:i(()=>[n(m,{modelValue:l.password,"onUpdate:modelValue":o[1]||(o[1]=d=>l.password=d),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ","prefix-icon":"Lock","show-password":"",autocomplete:"off",class:"custom-input"},null,8,["modelValue"])]),_:1}),n(c,null,{default:i(()=>[n(g,{type:"primary",onClick:q,loading:k.value,class:"login-btn"},{default:i(()=>[...o[3]||(o[3]=[z(" ç™»å½• ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])])}}},P=$(G,[["__scopeId","data-v-18a2dc9c"]]);export{P as default};
