import{g as n,J as i}from"./index-CXVfb7lr.js";const u={getUserInfo(){return n.get("/api/user/info").then(e=>{if(console.log("API响应原始数据:",e),e&&e.data){const r=e.data.code===200?e.data.data:e.data;return console.log("解析后的用户数据:",r),r}return Promise.reject(new Error("响应数据格式不正确"))}).catch(e=>{throw console.error("获取用户信息失败:",e),e})},login(e){return n.post("/api/user/login",e)},logout(){return n.post("/api/user/logout")},getAllUsers(){return n.get("/api/user/all").then(e=>{if(console.log("获取所有用户信息响应:",e),e&&e.data){const r=e.data.code===200?e.data.data:e.data;return console.log("解析后的所有用户数据:",r),r}return Promise.reject(new Error("响应数据格式不正确"))}).catch(e=>{throw console.error("获取所有用户信息失败:",e),e})}},m=i("user",{state:()=>({userInfo:{nickname:"",username:"",role:localStorage.getItem("userRole")||"user",avatar:"",email:"",phone:"",gender:null,birthdate:""},role:localStorage.getItem("userRole")||"user",loading:!1,error:null,initialized:!1}),getters:{displayName:e=>e.userInfo.nickname||e.userInfo.username||"用户",avatarOrInitials:e=>e.userInfo.avatar?e.userInfo.avatar:e.displayName.charAt(0).toUpperCase(),genderText:e=>e.userInfo.gender===null||e.userInfo.gender===void 0?"未设置":e.userInfo.gender===1?"男":"女",isAdmin:e=>e.role==="admin"},actions:{async initializeUserInfo(){this.loading=!0,this.error=null;try{const e=localStorage.getItem("userRole")||"user",r=localStorage.getItem("username")||"user";this.role=e;try{const a=await u.getUserInfo();if(console.log("从API获取的用户信息:",a),a&&typeof a=="object"){const t=a.data||a,o=t.role||a.role||e;console.log("从API提取的角色:",o);const l={nickname:t.nickname||t.username||r,username:t.username||r,role:o,avatar:t.avatar||"",email:t.email||"",phone:t.phone||"",gender:t.gender!==void 0?t.gender:null,birthdate:t.birthdate||""};this.userInfo=l,this.role=o,localStorage.setItem("userRole",o),console.log("用户角色已更新:",o);const s=a.username||r;localStorage.setItem("username",s)}}catch{console.log("API调用失败，使用本地存储的数据"),this.userInfo={nickname:r,username:r,role:e,avatar:"",email:"",phone:"",gender:null,birthdate:""}}this.initialized=!0}catch(e){console.error("初始化用户信息失败:",e);const r=localStorage.getItem("username")||"user",a=localStorage.getItem("userRole")||"user";this.userInfo={nickname:r,username:r,role:a,avatar:"",email:"",phone:"",gender:null,birthdate:""},this.role=a,localStorage.setItem("userRole",a),localStorage.setItem("username",r),this.initialized=!0}finally{this.loading=!1}},updateUserInfo(e){this.userInfo={...this.userInfo,...e}},clearUserInfo(){this.userInfo={nickname:"",username:"",avatar:"",email:"",phone:"",gender:null,birthdate:""},this.role="user",localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("token"),this.initialized=!1,this.error=null}}});export{u as a,m as u};
